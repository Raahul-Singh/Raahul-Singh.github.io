{{ define "main" }}
<article class="content book-content">
    <header class="content-header book-header">
        <div class="book-header-grid">
            {{ if .Params.cover_image }}
            <div class="book-cover-container">
                <img src="{{ .Params.cover_image | safeURL }}" alt="Cover of {{ .Title }}" class="book-cover-large" loading="lazy">
            </div>
            {{ end }}
            
            <div class="book-header-details">
                <h1 class="content-title">{{ .Title }}</h1>
                
                {{ with .Params.author }}
                <div class="book-author">
                    by <span class="author">{{ . }}</span>
                </div>
                {{ end }}
                
                {{ if .Params.rating }}
                <div class="book-rating-large">
                    <span class="rating-stars">
                        {{ $rating := int .Params.rating }}
                        {{ range seq $rating }}★{{ end }}
                        {{ if eq (mod .Params.rating 1) 0.5 }}½{{ end }}
                    </span>
                    <span class="rating-number">({{ .Params.rating }}/5)</span>
                </div>
                {{ end }}
                
                {{ if .Date }}
                <div class="content-meta">
                    <time datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
                        {{ .Date.Format "January 2, 2006" }}
                    </time>
                    
                    {{ with .Params.updated }}
                    <span class="update-info">(Updated: 
                        <time datetime="{{ . }}">{{ time.Format "January 2, 2006" . }}</time>)
                    </span>
                    {{ end }}
                </div>
                {{ end }}
                
                {{ with .Params.description }}
                <div class="content-abstract">
                    <p>{{ . }}</p>
                </div>
                {{ end }}
                
                {{ with .Params.tags }}
                <div class="content-tags">
                    {{ range . }}
                    <a href="{{ "tags/" | relLangURL }}{{ . | urlize }}" class="tag">{{ . }}</a>
                    {{ end }}
                </div>
                {{ end }}
            </div>
        </div>
    </header>

    {{ if .Site.Params.features.tableOfContents }}
    {{ if .TableOfContents }}
    <aside class="table-of-contents">
        <h2>Table of Contents</h2>
        {{ .TableOfContents }}
    </aside>
    {{ end }}
    {{ end }}

    <div class="content-body">
        {{ .Content }}
    </div>

    {{ if or .NextInSection .PrevInSection }}
    <div class="pagination">
        {{ if .PrevInSection }}
        <a href="{{ .PrevInSection.Permalink }}" class="prev">← {{ .PrevInSection.Title }}</a>
        {{ end }}
        
        {{ if .NextInSection }}
        <a href="{{ .NextInSection.Permalink }}" class="next">{{ .NextInSection.Title }} →</a>
        {{ end }}
    </div>
    {{ end }}
    
    {{ if .Site.Params.features.backlinks }}
    <div class="backlinks">
        <h3>Links to this page</h3>
        {{ $currentPath := .File.Path }}
        {{ $backlinks := slice }}
        {{ range .Site.RegularPages }}
            {{ if and .File }}
                {{ if not (eq $currentPath .File.Path) }}
                    {{ if findRE (printf "%s" $.File.ContentBaseName) .Plain }}
                        {{ $backlinks = $backlinks | append . }}
                    {{ end }}
                {{ end }}
            {{ end }}
        {{ end }}

        {{ if gt (len $backlinks) 0 }}
        <ul>
            {{ range $backlinks }}
            <li><a href="{{ .Permalink }}">{{ .Title }}</a></li>
            {{ end }}
        </ul>
        {{ else }}
        <p>No backlinks found.</p>
        {{ end }}
    </div>
    {{ end }}
</article>
{{ end }} 